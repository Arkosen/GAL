#!/usr/bin/perl

use strict;
use warnings;

use lib '../';

# Connect to your database.
use GAL::Schema;
my $schema = GAL::Schema->connect('DBI:mysql:database=pg_chinese_snp');

my $feature_rs    = $schema->resultset('Feature');
my $attributes_rs = $schema->resultset('Attribute');

#$feature_rs->result_class('DBIx::Class::ResultClass::HashRefInflator');

my $feature_cursor = $feature_rs->cursor;
while (my @feature_columns = $feature_cursor->next) {
	my $id = $feature_columns[0];
	my $ref_allele_rs = $attributes_rs->search({feature_id => $id,
						    att_key    => 'reference_allele'});
	my $ref_allele_cursor = $ref_allele_rs->cursor;
	my @ref_allele_columns = $ref_allele_cursor->next;
	my $ref_allele = $ref_allele_columns[3];
	print "$id\t$ref_allele\n";
}

#while (my $feature = $feature_rs->next) {
#	my $id         = $feature->id;
#	my $ref_allele = $feature->attributes->find({att_key => 'reference_allele'})->att_value;

#	my $id         = $feature->{feature_id};
#	my $ref_allele_rs = $attributes_rs->search({feature_id => $id,
#						    att_key    => 'reference_allele'});
#	$ref_allele_rs->result_class('DBIx::Class::ResultClass::HashRefInflator');
#	my $ref_allele_hash = $ref_allele_rs->first;
#	my $ref_allele = $ref_allele_hash->{att_value};

#	print "$id\t$ref_allele\n";
#}
