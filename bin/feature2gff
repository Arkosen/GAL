#!/usr/bin/perl
use strict;
use warnings;
use Getopt::Long;

use GAL::Parser;

#-----------------------------------------------------------------------------
#----------------------------------- MAIN ------------------------------------
#-----------------------------------------------------------------------------
my $usage = "

Synopsis:

feature2gff3 --format gigabayes gigabayes_output.gff

Description:

Convert various sequence feature formats to GFF3.

Options:

  --format   The format for the feature file (a subclass of Parser e.g.
             gigabayes, maq, clcbio, soap, celera);

";


my ($help, $format, $coverage);
my $opt_success = GetOptions('help'         => \$help,
			     'format=s'     => \$format,
			    );

die $usage if $help || ! $opt_success;

my @files = @ARGV;
die $usage unless @files;

my $class = "GAL::Parser::$format";
eval "require $class";
die $@ if $@;

for my $file (@files) {

	my $parser = $class->new(file => $file, coverage => $coverage);

	while (my $feature = $parser->next_feature_hash) {
		print $parser->to_gff3($feature);
	}
}

#-----------------------------------------------------------------------------
#------------------------------- SUBROUTINES ---------------------------------
#-----------------------------------------------------------------------------
