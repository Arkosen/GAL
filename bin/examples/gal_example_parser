#!/usr/bin/perl
use strict;
use warnings;
use Getopt::Long;

use GAL::Parser;

#-----------------------------------------------------------------------------
#----------------------------------- MAIN ------------------------------------
#-----------------------------------------------------------------------------

my $usage = "

Synopsis:

gal_example_script feature_file.txt

Description:

An example script of how to use the GAL library for parsing sequence
features.

";


my ($help);
my $opt_success = GetOptions('help'    => \$help,
			      );

if (! $opt_success) {
    print STDERR join ' : ', ('FATAL',
                              'command_line_parse_error',
                              'Use gff_tool --help to see correct usage');
}

if ($help) {
 print $usage;
 exit(0);
}

my $file = shift;
die $usage unless -e $file;

my $parser = GAL::Parser->new(file => $file);

while (my $feature = $parser->parse_next_feature) {

	my $seqid = $feature->seqid;
	my $type  = $feature->type;
	my @keys  = $feature->get_attribute_keys;
	my @variant_reads = $feature->get_attribute_values('variant_allele');

	# Do something

	# I haven't written the Feature.pm setter methods for
	# attributes yet (like add_attribute) Just manipulate the
	# attributes hash directly.

	$feature->{attributes}{genotype} = ['homozygous'];

	print "$seqid\t$type\t";
	print join ', ', @keys;
	print "\n";
}
